
// ISSUE 1 (FUNCTION DOES NOT WORK UNLESS THE BEGINNING OF SAMPLE IS SET BEFORE THE FIRST DATA POINT, SEE LINE 30 BELOW):

// LINEAR INTERPOLATION BASED ON AREMOS COMMAND REFERENCE PAGE 292
FUNCTION SERIES INTERP_QA_LIN(NAME %SER_IN, STRING %METH_IN 'AGGREGATE BY' = 'AVG');
// INPUTS: 
// 	NAME %SER_IN: NAME OF THE SERIES TO BE INTERPOLATED
// 	STRING %METH_IN: INTERPOLATION METHOD: AGGREGATE VIA AVG (DEFAULT) OR SUM
// OUTPUT:
// 	SER_OUT: INTERPOLATED SERIES (FREQ = Q)
	LOCAL SER_OUT, %DAT_START, %DAT_END, INCREMENT, %METH;  // TO AVOID POLLUTION OF DATABANK
	IF (%METH_IN == 'AVG'); 
		%METH = 'REPEAT';
	ELSE;
		%METH = 'PRORATE';
	END;
	BLOCK FREQ=Q;
		INTERPOLATE SER_OUT!Q = {%SER_IN}!A {%METH}; // FOR STOCK TYPE VARIABLES REPEAT, FOR FLOW TYPE VARIABLES PRORATE
		%DAT_START = FROMSERIES(SER_OUT, 'DATASTART');
		%DAT_END = FROMSERIES(SER_OUT, 'DATAEND');
		INCREMENT = (SER_OUT[+4] - SER_OUT)/4;
		INCREMENT <%DAT_END-3 %DAT_END> = INCREMENT[-4];
		SER_OUT <%DAT_START+1 %DAT_END> ^= INCREMENT[-1];
		SER_OUT <%DAT_START %DAT_END> -= 1.5*INCREMENT;
	END;
	RETURN SER_OUT!Q;
END;


// SET SAMPLE
%BNK_START = 1950; // CHANGE THIS TO 1920 TO MAKE THE FUNCTION WORK
%BNK_END = 2060;
TIME %BNK_START %BNK_END;


// LOAD DATA
IMPORT <ALL TSD> '\DAT\JP_A.TSD';

// INTERPOLATE ANNUAL DATA TO QUARTERLY
N_JP!Q = INTERP_QA_LIN(N_JP);
PRT <%CURR_YR-5 %CURR_YR+1> N_JP!Q, N_JP;



// ISSUE 2 (FOR SOME REASON THE PCH() FUNCTION DOES NOT WORK, BUT PRINTING THE SERIES WITH THE <P> OPTION DOES):

// LOAD DATA
IMPORT <ALL TSD> '\DAT\JP_Q.TSD';

// TRY TO PRINT THE PERCENTAGE CHANGE
PRINT PCH(EMPL_JP!Q);
PRINT EMPL_JP!Q;
PRINT <P> EMPL_JP!Q;
DISP EMPL_JP!Q;

